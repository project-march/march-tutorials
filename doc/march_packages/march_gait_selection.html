

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>march_gait_selection &mdash; Project March Melodic documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/override.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'Melodic',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="march_hardware" href="march_hardware.html" />
    <link rel="prev" title="march_gait_files" href="march_gait_files.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/create_your_workspace.html">Create your workspace</a></li>
</ul>
<p class="caption"><span class="caption-text">Useful tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/robot_model.html">Robot model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/ros_control.html">ros_control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/rqt.html">RQT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/ros_bag.html">ROS bag</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/gazebo.html">Gazebo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/event_stream_processing.html">Event stream Processing</a></li>
</ul>
<p class="caption"><span class="caption-text">Using the March Exoskeleton</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/high_level_overview.html">High level overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/connecting_to_the_exoskeleton.html">Connecting to the exoskeleton</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/how_to_airgait.html">How to airgait</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/how_to_view_live_data.html">How to view live data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/log_files.html">Log files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/using_the_gait_generator.html">Using the gait generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/error_codes.html">Error Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/using_the_pressure_soles.html">Using the pressure soles</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../continuous_integration/continuous_integration.html">Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/style_guide.html">Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/add_a_new_gait.html">Add a new gait</a></li>
</ul>
<p class="caption"><span class="caption-text">March Packages</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="march_data_collector.html">march_data_collector</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_description.html">march_description</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_ems_projects.html">march_ems_projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_fake_sensor_data.html">march_fake_sensor_data</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_gain_scheduling.html">march_gain_scheduling</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_gait_files.html">march_gait_files</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">march_gait_selection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#behavior">Behavior</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gait-selection-services">Gait selection services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gait-interface">Gait interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gait-state-machine">Gait state machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gait-state-machine-input">Gait state machine input</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trajectory-scheduler">Trajectory scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transition-subgait">Transition subgait</a></li>
<li class="toctree-l3"><a class="reference internal" href="#balance-walk">Balance walk</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ros-api">ROS API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#nodes">Nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subscribed-topics">Subscribed Topics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#published-topics">Published Topics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#services">Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameters">Parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="march_hardware.html">march_hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_hardware_builder.html">march_hardware_builder</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_hardware_interface.html">march_hardware_interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_imu_manager.html">march_imu_manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_input_device.html">march_input_device</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_launch.html">march_launch</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_moveit.html">march_moveit</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_rqt_input_device.html">march_rqt_input_device</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_safety.html">march_safety</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_shared_classes.html">march_shared_classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_shared_resources.html">march_shared_resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_simulation.html">march_simulation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Project March</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>march_gait_selection</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/project-march/tutorials/blob/master/doc/march_packages/march_gait_selection.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="march-gait-selection">
<span id="march-gait-selection-label"></span><h1>march_gait_selection<a class="headerlink" href="#march-gait-selection" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The march_gait_selection module is responsible for loading the specified gait
directory, generating a gait state machine and keeping track of exoskeleton
state. It uses the march_gait_files, which are parsed using the
march_shared_classes, to gather gait information in a standard format. Gait
class objects are stored as attributes in the <code class="docutils literal"><span class="pre">GaitSelection</span></code> object. The gait
selection node can use this <code class="docutils literal"><span class="pre">GaitSelection</span></code> object to extract the data
corresponding to the requested gait/subgait name.</p>
</div>
<div class="section" id="behavior">
<h2>Behavior<a class="headerlink" href="#behavior" title="Permalink to this headline">¶</a></h2>
<p>The gait state machine accepts or declines a gait request originating from an
input device. If the gait is accepted by the state machine, the requested gait
will be loaded from the <code class="docutils literal"><span class="pre">GaitSelection</span></code> instance and performed. If executed
correctly, subgait trajectories will be sent over to the trajectory controller.
While the gait is being performed, the state machine will listen for more input
from the user about stopping or transitioning and inform the performing gait
when a request is made.</p>
<div class="section" id="gait-selection-services">
<h3>Gait selection services<a class="headerlink" href="#gait-selection-services" title="Permalink to this headline">¶</a></h3>
<p>The gait_selection_node also acts as a server for requesting subgait versions
and changing versions of subgaits.</p>
</div>
<div class="section" id="gait-interface">
<h3>Gait interface<a class="headerlink" href="#gait-interface" title="Permalink to this headline">¶</a></h3>
<p>The package contains a class named <code class="docutils literal"><span class="pre">GaitInterface</span></code>, which is the interface
that should be implemented for any executable gait. The gaits loaded from the
gait directory have their own implementation called <code class="docutils literal"><span class="pre">SetpointsGait</span></code> and the
home gaits have their implementation named <code class="docutils literal"><span class="pre">HomeGait</span></code>. Any other gaits not
included in these classes should be implemented separately, for example, the
<code class="docutils literal"><span class="pre">BalanceGait</span></code>. The implemented gait can then be added to the <code class="docutils literal"><span class="pre">GaitSelection</span></code>
and will then also be added to the gait state machine.</p>
</div>
<div class="section" id="gait-state-machine">
<h3>Gait state machine<a class="headerlink" href="#gait-state-machine" title="Permalink to this headline">¶</a></h3>
<p>The state machine has two main phases: generating and running. First, when all
gaits have been loaded and added to the <code class="docutils literal"><span class="pre">GaitSelection</span></code> instance, the state
machine structure is generated. This is done by comparing all start and end
points of gaits and generating idle positions and home gaits. The transitions
are then stored as an adjacency list for constant time access of transitions.
When the generation phase finishes successfully, the state machine can be
started. The starting state is always <code class="docutils literal"><span class="pre">UNKNOWN</span></code> and the first action should be
to home to a known idle position. The state machine differentiates between to
main states: idle and gait. When it is idle it will listen for gait input and
when it is performing a gait it will keep updating the gait in a loop until it
decides to stop.</p>
<p>Finally, the state machine has the ability to add callbacks when different
actions happen in the state machine. This is useful for publishing gait and
state information or other actions that should trigger on certain transitions.</p>
</div>
<div class="section" id="gait-state-machine-input">
<h3>Gait state machine input<a class="headerlink" href="#gait-state-machine-input" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">StateMachineInput</span></code> class is used for communicating input to the
<code class="docutils literal"><span class="pre">GaitStateMachine</span></code>. Any implementation of this class should be able to give
input to the <code class="docutils literal"><span class="pre">GaitStateMachine</span></code>, however, it is currently implemented to
listen for the input device topic.</p>
</div>
<div class="section" id="trajectory-scheduler">
<h3>Trajectory scheduler<a class="headerlink" href="#trajectory-scheduler" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">TrajectoryScheduler</span></code> is another dependency of the state machine. It gets
as input a trajectory from the state machine and communicates when it fails.</p>
</div>
<div class="section" id="transition-subgait">
<h3>Transition subgait<a class="headerlink" href="#transition-subgait" title="Permalink to this headline">¶</a></h3>
<p>It is possible to transition between two matching named subgaits of two
different gaits (for example between the right swing of the walk small and walk
large). The transitioning of gaits is currently implemented in the
<code class="docutils literal"><span class="pre">SetpointsGait</span></code> class, which responds to the transition requests. It uses the
underlying subgait graph for determining whether the transition is possible.</p>
</div>
<div class="section" id="balance-walk">
<h3>Balance walk<a class="headerlink" href="#balance-walk" title="Permalink to this headline">¶</a></h3>
<p>The gait selection packages is currently also the package where we store dynamic gaits. One such dynamic gait is the
balance walk gait. The graph of the balance walk gait is defined in the <a class="reference internal" href="march_gait_files.html#march-gait-files-label"><span class="std std-ref">march_gait_files</span></a>.
Some of the subgaits in this gait are just static subgaits defined by a subgaitfile. However, some of the subgaits are dynamic.
In these subgaits we try to move towards a capture point. A capture point is a point on the ground such that if you would
place your foot there, you would come to a full stop. There are a lot of papers on the internet about this, most importantly
the one introducing the principle is this <a class="reference external" href="https://ieeexplore-ieee-org.tudelft.idm.oclc.org/document/4115602">paper</a>
A capture point is calculated in the <a class="reference internal" href="march_data_collector.html#march-data-collector-label"><span class="std std-ref">march_data_collector</span></a> based on the inverted pendulum model and the movement of the center of mass.
We use the motion planning framework MoveIt to calculate a trajectory for the swing leg towards this point. For the stance leg, the regular
gait file is used to determine the endpoint and MoveIt is then used to calculate a trajectory towards this point.
The balance gait class then uses the <a class="reference external" href="http://docs.ros.org/jade/api/moveit_commander/html/classmoveit__commander_1_1move__group_1_1MoveGroupCommander.html">python moveIt commander Interface</a> to plan. More information on MoveIt and
the integration can be found at <a class="reference internal" href="march_moveit.html#march-moveit-label"><span class="std std-ref">march_moveit</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Improved versions of the balance walk gait are continuously researched and developed.
The above description is likely slightly outdated.</p>
</div>
</div>
</div>
<div class="section" id="ros-api">
<h2>ROS API<a class="headerlink" href="#ros-api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="nodes">
<h3>Nodes<a class="headerlink" href="#nodes" title="Permalink to this headline">¶</a></h3>
<p><em>gait_selection_node</em> - Responsible for adding gait file information to the gait request.</p>
</div>
<div class="section" id="subscribed-topics">
<h3>Subscribed Topics<a class="headerlink" href="#subscribed-topics" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><em>/march/error</em> (<a class="reference external" href="https://github.com/project-march/march/tree/develop/march_shared_resources/msg/Error.msg">march_shared_resources/msg/Error</a>)</dt>
<dd>Listens for errors and shuts down when a fatal is thrown.</dd>
</dl>
</div>
<div class="section" id="published-topics">
<h3>Published Topics<a class="headerlink" href="#published-topics" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><em>/march/gait_selection/current_state</em> (<a class="reference external" href="https://github.com/project-march/march/tree/develop/march_shared_resources/msg/CurrentState.msg">march_shared_resources/msg/CurrentState</a>)</dt>
<dd>Publishes the current state of the state machine</dd>
<dt><em>/march/gait_selection/current_gait</em> (<a class="reference external" href="https://github.com/project-march/march/tree/develop/march_shared_resources/msg/CurrentGait.msg">march_shared_resources/msg/CurrentGait</a>)</dt>
<dd>Sends details about the current gait being performed</dd>
</dl>
</div>
<div class="section" id="services">
<h3>Services<a class="headerlink" href="#services" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><em>/march/gait_selection/get_version_map</em> (<a class="reference external" href="http://docs.ros.org/melodic/api/std_srvs/html/srv/Trigger.html">std_srvs/srv/Trigger</a>)</dt>
<dd>Returns the current loaded gait version map.</dd>
<dt><em>/march/gait_selection/set_gait_version</em> (<a class="reference external" href="https://github.com/project-march/march/tree/develop/march_shared_resources/srv/SetGaitVersion.srv">march_shared_resources/srv/SetGaitVersion</a>)</dt>
<dd>Sets a new gait version map in the gait_selection.</dd>
<dt><em>/march/gait_selection/get_directory_structure</em> (<a class="reference external" href="http://docs.ros.org/melodic/api/std_srvs/html/srv/Trigger.html">std_srvs/srv/Trigger</a>)</dt>
<dd>Returns the directory structure of the gait_files repository.</dd>
<dt><em>/march/gait_selection/update_default_versions</em> (<a class="reference external" href="http://docs.ros.org/melodic/api/std_srvs/html/srv/Trigger.html">std_srvs/srv/Trigger</a>)</dt>
<dd>Calls the update_default_versions function of the gait_selection.</dd>
<dt><em>/march/gait_selection/contains_gait</em> (<a class="reference external" href="https://github.com/project-march/march/tree/develop/march_shared_resources/srv/ContainsGait.srv">march_shared_resources/srv/ContainsGait</a>)</dt>
<dd>Checks if gait is in parsed gaits in the gait selection module.</dd>
<dt><em>/march/gait_selection/get_possible_gaits</em> (<a class="reference external" href="https://github.com/project-march/march/tree/develop/march_shared_resources/srv/PossibleGaits.srv">march_shared_resources/srv/PossibleGaits</a>)</dt>
<dd>Checks if gait is in parsed gaits in the gait selection module.</dd>
</dl>
</div>
<div class="section" id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><em>march_gait_selection/gait_package</em> (<em>string</em>, default: <code class="docutils literal"><span class="pre">march_gait_files</span></code>)</dt>
<dd>The package where the gait files are located.</dd>
<dt><em>march_gait_selection/gait_directory</em> (<em>string</em>, default: <code class="docutils literal"><span class="pre">training-v</span></code>)</dt>
<dd>The directory where the gait files are located, relative to the above package.</dd>
<dt><em>march_gait_selection/update_rate</em> (<em>float</em>, default: <code class="docutils literal"><span class="pre">120.0</span></code>)</dt>
<dd>The update rate of the gait state machine in Hertz.</dd>
<dt><em>march_gait_selection/sounds</em> (<em>bool</em>, default: <code class="docutils literal"><span class="pre">false</span></code>)</dt>
<dd>The update rate of the gait state machine in Hertz.</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="march_hardware.html" class="btn btn-neutral float-right" title="march_hardware" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="march_gait_files.html" class="btn btn-neutral float-left" title="march_gait_files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Project March
      <span class="lastupdated">
        Last updated on Sep 16, 2020.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>