

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>march_input_device &mdash; Project March Melodic documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'Melodic',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/override.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="march_launch" href="march_launch.html" />
    <link rel="prev" title="march_imu_manager" href="march_imu_manager.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/create_your_workspace.html">Create your workspace</a></li>
</ul>
<p class="caption"><span class="caption-text">Useful tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/robot_model.html">Robot model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/ros_control.html">ros_control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/rqt.html">RQT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/ros_bag.html">ROS bag</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/gazebo.html">Gazebo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/smach.html">SMACH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/event_stream_processing.html">Event stream Processing</a></li>
</ul>
<p class="caption"><span class="caption-text">Using the March Exoskeleton</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/high_level_overview.html">High level overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/connecting_to_the_exoskeleton.html">Connecting to the exoskeleton</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/how_to_airgait.html">How to airgait</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/how_to_view_live_data.html">How to view live data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/log_files.html">Log files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/using_the_gait_generator.html">Using the gait generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/error_codes.html">Error Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/using_the_pressure_soles.html">Using the pressure soles</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../continuous_integration/continuous_integration.html">Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/style_guide.html">Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/add_a_new_gait.html">Add a new gait</a></li>
</ul>
<p class="caption"><span class="caption-text">March Packages</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="march_data_collector.html">march_data_collector</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_description.html">march_description</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_fake_sensor_data.html">march_fake_sensor_data</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_gain_scheduling.html">march_gain_scheduling</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_gait_files.html">march_gait_files</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_hardware.html">march_hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_hardware_builder.html">march_hardware_builder</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_hardware_interface.html">march_hardware_interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_imu_manager.html">march_imu_manager</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">march_input_device</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ros-api">ROS API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#published-topics">Published Topics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subscribed-topics">Subscribed Topics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tutorials">Tutorials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#set-correct-permissions-on-linux">Set correct permissions on Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-run-wired">How to run wired</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#upload-the-code-on-the-input-device">Upload the code on the input device</a></li>
<li class="toctree-l4"><a class="reference internal" href="#start-the-software">Start the software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-run-wireless">How to run wireless</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Upload the code on the input device</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Start the software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-add-a-gait">How to add a gait</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="march_launch.html">march_launch</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_rqt_input_device.html">march_rqt_input_device</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_rqt_software_check.html">march_rqt_software_check</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_safety.html">march_safety</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_shared_classes.html">march_shared_classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_shared_resources.html">march_shared_resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_state_machine.html">march_state_machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_gait_selection.html">march_gait_selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_simulation.html">march_simulation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Project March</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>march_input_device</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/project-march/tutorials/blob/master/doc/march_packages/march_input_device.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="march-input-device">
<span id="march-input-device-label"></span><h1>march_input_device<a class="headerlink" href="#march-input-device" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The march_input_device is the software running on the March exoskeleton input device. The input device is used
to give input to the software running on the March exoskeleton. See the
<a class="reference external" href="https://github.com/project-march/input-device/tree/develop/">project-march/input-device</a> repository for more info.</p>
</div>
<div class="section" id="ros-api">
<h2>ROS API<a class="headerlink" href="#ros-api" title="Permalink to this headline">¶</a></h2>
<p>The communication between the input device and the March exoskeleton is done with <a class="reference external" href="http://wiki.ros.org/rosserial">rosserial</a>.
This can be run wired via usb cable or wireless via wifi connection.</p>
<div class="section" id="published-topics">
<h3>Published Topics<a class="headerlink" href="#published-topics" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><em>/march/input_device/instruction</em> (<a class="reference external" href="https://github.com/project-march/march/tree/develop/march_shared_resources/msg/GaitInstruction.msg">march_shared_resources/GaitInstruction</a>)</dt>
<dd>Sends instructions to execute</dd>
<dt><em>/march/input_device/alive</em> (<a class="reference external" href="http://docs.ros.org/melodic/api/std_msgs/html/msg/Time.html">std_msgs/Time</a>)</dt>
<dd>Publish empty alive messages so <a class="reference internal" href="march_safety.html#march-safety-label"><span class="std std-ref">march_safety</span></a> does not throw an error.</dd>
</dl>
</div>
<div class="section" id="subscribed-topics">
<h3>Subscribed Topics<a class="headerlink" href="#subscribed-topics" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><em>/march/input_device/instruction_response</em> (<a class="reference external" href="https://github.com/project-march/march/tree/develop/march_shared_resources/msg/GaitInstructionResponse.msg">march_shared_resources/GaitInstructionResponse</a>)</dt>
<dd>Receives responses to instructions executed on <em>/march/input_device/instruction</em></dd>
</dl>
</div>
</div>
<div class="section" id="tutorials">
<h2>Tutorials<a class="headerlink" href="#tutorials" title="Permalink to this headline">¶</a></h2>
<div class="section" id="set-correct-permissions-on-linux">
<h3>Set correct permissions on Linux<a class="headerlink" href="#set-correct-permissions-on-linux" title="Permalink to this headline">¶</a></h3>
<p>The following error can occur when trying to access the ttyUSB port:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Cannot</span> <span class="nb">open</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">ttyUSB0</span><span class="p">:</span> <span class="n">Permission</span> <span class="n">denied</span>
</pre></div>
</div>
<p>To make sure your user is allowed to access the port, add your user to the required groups:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>sudo usermod -a -G tty $USER
sudo usermod -a -G dialout $USER
</pre></div>
</div>
<p>Now log out on your computer and log back in, the error should be resolved.</p>
<p><a class="reference external" href="https://github.com/esp8266/source-code-examples/issues/26">Source</a></p>
</div>
<div class="section" id="how-to-run-wired">
<h3>How to run wired<a class="headerlink" href="#how-to-run-wired" title="Permalink to this headline">¶</a></h3>
<div class="section" id="upload-the-code-on-the-input-device">
<h4>Upload the code on the input device<a class="headerlink" href="#upload-the-code-on-the-input-device" title="Permalink to this headline">¶</a></h4>
<p>Skip this section if the correct code for running wired is already on the input device.
For more detailed information on how to run and upload the code see the <a class="reference external" href="https://github.com/project-march/input-device/tree/develop/">README</a>.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">pio</span> <span class="n">run</span> <span class="o">-</span><span class="n">t</span> <span class="n">upload</span>
</pre></div>
</div>
</div>
<div class="section" id="start-the-software">
<h4>Start the software<a class="headerlink" href="#start-the-software" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Make sure the jumper cap in the electronics holder is placed so the input device is powered via the USB cable rather than via batteries.</li>
<li>Connect the input device via usb cable, this powers and launches the input device automatically.</li>
<li>Type in a terminal:</li>
</ul>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">roslaunch</span> <span class="n">march_launch</span> <span class="n">serial_connection</span><span class="o">.</span><span class="n">launch</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-run-wireless">
<h3>How to run wireless<a class="headerlink" href="#how-to-run-wireless" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure the pc that needs to receive the messages and the input device are on the same network.</p>
</div>
<div class="section" id="id1">
<h4>Upload the code on the input device<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Skip this section if the correct code for running wireless is already on the input device.
For more detailed information on how to run and upload the code see the <a class="reference external" href="https://github.com/project-march/input-device/tree/develop/">README</a>.</p>
<ul class="simple">
<li>Uncomment <code class="docutils literal"><span class="pre">#define</span> <span class="pre">USE_WIRELESS</span></code> in the <em>main.cpp</em>.</li>
<li>Type in terminal: <code class="docutils literal"><span class="pre">hostname</span> <span class="pre">-I</span></code>, this is your IP address.</li>
<li>Open <a class="reference external" href="https://github.com/project-march/input-device/tree/develop/include/wireless_connection.h">wireless_connection.h</a><ul>
<li>at <code class="docutils literal"><span class="pre">IPAddress</span> <span class="pre">server(x,</span> <span class="pre">x,</span> <span class="pre">x,</span> <span class="pre">x)</span></code> fill the xs with the four numbers
of your IP address from the previous step.</li>
<li>Change the value of <code class="docutils literal"><span class="pre">ssid</span></code> to the name of the WiFi network.</li>
<li>Change the value of <code class="docutils literal"><span class="pre">password</span></code> to the password of the WiFi network.</li>
</ul>
</li>
<li>Compile and upload to the input device.</li>
</ul>
</div>
<div class="section" id="id2">
<h4>Start the software<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Type in every terminal you are going to use (replace <code class="docutils literal"><span class="pre">&lt;your_ip_address&gt;</span></code> with the output from <code class="docutils literal"><span class="pre">hostname</span> <span class="pre">-I</span></code>):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ROS_MASTER_URI</span><span class="o">=</span>http://&lt;your_ip_address&gt;:11311/
</pre></div>
</div>
</li>
<li><p class="first">Type in a terminal:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">roslaunch</span> <span class="n">march_launch</span> <span class="n">serial_connection</span><span class="o">.</span><span class="n">launch</span> <span class="n">wireless</span><span class="p">:</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
</li>
<li><p class="first">Make sure the batteries are charged and in the input device.</p>
</li>
<li><p class="first">Make sure the jumper cap in the electronics holder is placed so the input device is powered by the batteries rather than via a USB cable.</p>
</li>
<li><p class="first">Press the on/off button to turn on the input device. The button is located on the electronics holder of the input device.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="how-to-add-a-gait">
<span id="how-to-add-a-gait-label"></span><h3>How to add a gait<a class="headerlink" href="#how-to-add-a-gait" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Make new screens for the new gait, for normal, selected and activated.</p>
</li>
<li><p class="first">Make sure the new gait/new screens fit in the menu &amp; create a selected &amp; activated screen for the new gait.</p>
</li>
<li><p class="first">Put the screens on the SD card. Use the 4D Systems Workshop4 IDE software for this.</p>
</li>
<li><p class="first">Define the sector address of the images to be loaded on the screen in <em>sd_sector_addresses.h</em>.
These addresses can be found via the 4D Systems Workshop4 IDE software. First
load the desired images on the uSD card, then find the sector addresses of
said images via the generated .Gc file. Example:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="c1">// New gait</span>
<span class="cp">#define NEW_GAIT SectorAddress { 0x0000, 0x0050 }</span>
<span class="cp">#define NEW_GAIT_SELECTED SectorAddress { 0x0000, 0x0100 }</span>
<span class="cp">#define NEW_GAIT_ACTIVATED SectorAddress { 0x0000, 0x0200 }</span>
</pre></div>
</div>
<p>The first value is the high part of the address and the second the low part.</p>
</li>
<li><p class="first">For this example, we will create a new gait screen next to the walk screen.
Create a new state, i.e. gait, in the constructor of <em>state_machine.cpp</em>.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">State</span><span class="o">&amp;</span> <span class="n">new_gait</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">createGaitState</span><span class="p">(</span><span class="n">NEW_GAIT</span><span class="p">,</span> <span class="n">NEW_GAIT_SELECTED</span><span class="p">,</span> <span class="n">NEW_GAIT_ACTIVATED</span><span class="p">,</span> <span class="s">&quot;new_gait&quot;</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">createGaitState</span></code> function automatically creates 3 new states for the
normal, selected and activated screen with connections between them and adds
the state to the state machine. The final argument is a pointer to a state the
gait should go to once succeeded. In our case we want to return to the
new_gait screen after it succeeded, so we pass <code class="docutils literal"><span class="pre">nullptr</span></code>.</p>
</li>
<li><p class="first">Now connect the new state to the walk state</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">new_gait</span><span class="p">.</span><span class="n">withRight</span><span class="p">(</span><span class="o">&amp;</span><span class="n">walk</span><span class="p">);</span>
</pre></div>
</div>
<p>This creates a connection between the new_gait and walk screens. From new_gait
we can move right to walk and from walk we can move left to new_gait. See the
<a class="reference external" href="https://github.com/project-march/input-device/tree/develop/include/state.h">state.h</a> header file for more methods to
connect states.</p>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="march_launch.html" class="btn btn-neutral float-right" title="march_launch" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="march_imu_manager.html" class="btn btn-neutral float-left" title="march_imu_manager" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Project March
      <span class="lastupdated">
        Last updated on Jun 05, 2020.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>